

Collaborate

Share
Max
Ù…Ù…ØªØ§Ø²! Ø³Ø£Ø¬Ù‡Ø² Ù„Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø« Ø¨Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¢Ù†.
I discovered the deployment issue was due to incompatible `python-telegram-bot` library with Python 3.13. Updating `requirements.txt` to version 21.7 will fix this, enabling successful deployment.

Ø¨Ø³ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ø¹Ø·Ø§Ù†ÙŠ Ø§ÙŠØ§Ù‡ Ù…Ù† Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ ÙÙŠ Ø§Ù„ØªÙ„Ù‚Ø±Ø§Ù† Ø¹Ø§Ø¯ÙŠ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„Ø¨ÙˆØªØŸ
Max
Ù†Ø¹Ù…ØŒ Ø¹Ø§Ø¯ÙŠ Ø¬Ø¯Ø§Ù‹ ÙˆÙ‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„Ø¶Ø¨Ø·! âœ…
Ø§Ù„Ø±Ù‚Ù… 1177923997 Ù‡Ùˆ User ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….
Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…:
Ø¢Ù…Ù† Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ù„ÙŠØ³ Ø³Ø±ÙŠ Ù…Ø«Ù„ Ø§Ù„ØªÙˆÙƒÙ†)
Ø«Ø§Ø¨Øª ÙˆÙ„Ø§ ÙŠØªØºÙŠØ± Ø£Ø¨Ø¯Ø§Ù‹
ÙŠØ³ØªØ®Ø¯Ù…Ù‡ Ø§Ù„Ù…Ø·ÙˆØ±ÙˆÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
ÙƒÙŠÙ Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…:
Ø§Ù„Ø´Ø®Øµ
Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø«
Ø£Ù†Øª (1177923997)
ØªØ¯Ø®Ù„ Ø§Ù„Ø¨ÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨
Ø£ÙŠ Ø´Ø®Øµ Ø¢Ø®Ø±
ÙŠØ±Ø³Ù„ Ø·Ù„Ø¨ ÙˆØµÙˆÙ„ØŒ ÙˆØ£Ù†Øª ØªØ³ØªÙ„Ù… Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„Ø±ÙØ¶
Ø³Ø£Ø¬Ù‡Ø² Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù†...
I confirmed the access request system update for the bot, ensuring the owner can access directly while others must request permission. The updated code is now saved.

Max
ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø« Ø¨Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„! ğŸ”’
Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
Ø§Ù„Ù…ÙŠØ²Ø©
Ø§Ù„ÙˆØµÙ
Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„
Ø£ÙŠ Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ ÙŠØ±Ø³Ù„ Ø·Ù„Ø¨ ÙˆØ£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø£Ùˆ ØªØ±ÙØ¶
Ø£Ù†Øª Ø§Ù„Ù…Ø´Ø±Ù
ID: 1177923997 - ØªØ¯Ø®Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨
Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©
ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ ÙƒÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† ÙŠÙØ­ÙØ¸ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
Ø§Ù„Ø£Ù…Ø±
Ø§Ù„ÙˆØ¸ÙŠÙØ©
/admin
Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù
/users
Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†
/pending
Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
/remove [ID]
Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù…
ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ GitHub:
Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Repository Ø¹Ù„Ù‰ GitHub
Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ù„Ù bot.py
Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… (Edit) âœï¸
Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙ‚ bot_updated.py ÙˆØ§Ù„ØµÙ‚Ù‡
Ø§Ø¶ØºØ· Commit changes
Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ GitHub:
Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Render ÙˆØ§Ø¶ØºØ·:
Manual Deploy > Clear build cache & deploy
ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…:
Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ ÙŠØ±Ø³Ù„ /start Ù„Ù„Ø¨ÙˆØª
ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ÙÙŠÙ‡Ø§ Ø§Ø³Ù…Ù‡ ÙˆÙŠÙˆØ²Ø±Ù‡ Ù…Ø¹ Ø²Ø±ÙŠÙ† (âœ… Ù…ÙˆØ§ÙÙ‚Ø© / âŒ Ø±ÙØ¶)
Ø¥Ø°Ø§ ÙˆØ§ÙÙ‚Øª - ÙŠÙ‚Ø¯Ø± ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙˆØª
Ø¥Ø°Ø§ Ø±ÙØ¶Øª - Ù…Ø§ ÙŠÙ‚Ø¯Ø± ÙŠØ¯Ø®Ù„
Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŸ
bot_updated.py
Code Â· 28.42 KB

View all files in this task
Ù‡Ù„ Ø§Ø³ØªØ·ÙŠØ¹ Ø±Ø¨Ø·Ù‡ Ù…Ø¹ finfiz ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±ØªØ§Øª Ù…Ù†Ù‡ØŸ
Max
Ø³Ø¤Ø§Ù„ Ù…Ù…ØªØ§Ø²! Ù†Ø¹Ù…ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±ØªØ§Øª Ù…Ù† FinvizØŒ Ù„ÙƒÙ† Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø­Ø¯Ø¯Ø©:
Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù€ Finviz:
Ø§Ù„Ù…ÙŠØ²Ø©
Ù…ØªØ§Ø­ØŸ
Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©
ØµÙˆØ± Ø§Ù„Ø´Ø§Ø±ØªØ§Øª
âœ… Ù†Ø¹Ù…
Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ØµÙˆØ±
API Ø±Ø³Ù…ÙŠ
âŒ Ù„Ø§
Ù„Ø§ ÙŠÙˆØ¬Ø¯ API Ø¹Ø§Ù…
Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
âš ï¸ Ù…Ø­Ø¯ÙˆØ¯
Scraping (Ù‚Ø¯ ÙŠÙØ­Ø¸Ø±)
Ù…Ø§ ÙŠÙ…ÙƒÙ† ÙØ¹Ù„Ù‡:
1. Ø¬Ù„Ø¨ ØµÙˆØ± Ø§Ù„Ø´Ø§Ø±ØªØ§Øª (Ø³Ù‡Ù„ ÙˆÙ‚Ø§Ù†ÙˆÙ†ÙŠ)
Finviz ÙŠÙˆÙØ± Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ØµÙˆØ± Ø§Ù„Ø´Ø§Ø±ØªØ§Øª:
Plain Text
https://finviz.com/chart.ashx?t=AAPL&ty=c&ta=1&p=d
Ø§Ù„Ù…Ø¹Ø§Ù…Ù„
Ø§Ù„Ù‚ÙŠÙ…
t
Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù… (AAPL, TSLA... )
ty
c = Ø´Ù…ÙˆØ¹ØŒ l = Ø®Ø·ÙŠ
ta
1 = Ù…Ø¹ Ù…Ø¤Ø´Ø±Ø§ØªØŒ 0 = Ø¨Ø¯ÙˆÙ†
p
d = ÙŠÙˆÙ…ÙŠØŒ w = Ø£Ø³Ø¨ÙˆØ¹ÙŠØŒ m = Ø´Ù‡Ø±ÙŠ
Ù‡Ù„ ØªØ±ÙŠØ¯Ù†ÙŠ Ø£Ø¶ÙŠÙ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù„Ù„Ø¨ÙˆØªØŸ
Ø³Ø£Ø¬Ø¹Ù„ Ø§Ù„Ø¨ÙˆØª ÙŠØ±Ø³Ù„ Ù„Ùƒ:
ØµÙˆØ±Ø© Ø§Ù„Ø´Ø§Ø±Øª Ù…Ù† Finviz
Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ (Ø¥Ù„ÙŠÙˆØªØŒ ICTØŒ Ø¥Ù„Ø®)
Ù…Ø¹Ø§Ù‹ ÙÙŠ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø©!
Ù…Ù„Ø§Ø­Ø¸Ø©: ØµÙˆØ± Finviz Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ© (NYSE, NASDAQ).
Ù‡Ù„ ØªØ±ÙŠØ¯Ù†ÙŠ Ø£Ø¶ÙŠÙ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©ØŸ
Ù†Ø¹Ù… Ù„ÙˆØ³Ù…Ø­Øª ÙˆÙ„ÙƒÙ† Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹ Ø¹Ù†Ø¯ Ø§Ø±Ø³Ø§Ù„ ØµÙˆØ±Ù‡ Ø§Ù„Ø´Ø§Ø±Øª Ø§Ù† ØªØ¶Ø¹ Ø§Ù„Ø±Ø³Ù… Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ØŸ
Max
Ø³Ø¤Ø§Ù„ Ù…Ù…ØªØ§Ø²! Ù†Ø¹Ù…ØŒ Ø£Ø³ØªØ·ÙŠØ¹ Ø°Ù„Ùƒ! ğŸ¨
Ø³Ø£Ø¬Ø¹Ù„ Ø§Ù„Ø¨ÙˆØª ÙŠØ±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±Øª:
Ù…Ø§ Ø³ÙŠÙØ±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±Øª:
Ø§Ù„ØªØ­Ù„ÙŠÙ„
Ø§Ù„Ø±Ø³Ù…
Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª
ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ù…ÙˆØ¬Ø§Øª (1,2,3,4,5) Ùˆ (A,B,C) Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù…Ù… ÙˆØ§Ù„Ù‚ÙŠØ¹Ø§Ù†
Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©
Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ© Ù…Ù„ÙˆÙ†Ø©
Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ©
Ø®Ø·ÙˆØ· XABCD Ù…Ø¹ Ù†Ø³Ø¨ ÙÙŠØ¨ÙˆÙ†Ø§ØªØ´ÙŠ
ICT
Ù…Ù†Ø§Ø·Ù‚ Order Blocks Ùˆ FVG Ù…Ø¸Ù„Ù„Ø©
Ø®Ø·ÙˆØ· Ø§Ù„Ø§ØªØ¬Ø§Ù‡
Ø®Ø·ÙˆØ· Ù…Ø§Ø¦Ù„Ø©
ÙƒÙŠÙ Ø³ÙŠØ¹Ù…Ù„:
Ø§Ù„Ø¨ÙˆØª ÙŠØ¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù‡Ù…
ÙŠØ±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Øª Ø¨Ù†ÙØ³Ù‡ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Python)
ÙŠØ¶ÙŠÙ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ù…
ÙŠØ±Ø³Ù„ Ù„Ùƒ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø´Ø±Ø­
Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:
Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ± Finviz (Ù„Ø£Ù†Ù‡Ø§ Ø¬Ø§Ù‡Ø²Ø© ÙˆÙ„Ø§ Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø±Ø³Ù… Ø¹Ù„ÙŠÙ‡Ø§)ØŒ Ø³Ø£Ø¬Ø¹Ù„ Ø§Ù„Ø¨ÙˆØª ÙŠØ±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Øª Ø¨Ù†ÙØ³Ù‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© matplotlib Ø£Ùˆ mplfinance.
Ù‡Ø°Ø§ Ø£ÙØ¶Ù„ Ù„Ø£Ù†Ù‡:
âœ… Ù†ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø±Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
âœ… Ù†Ø¶ÙŠÙ Ø£ÙŠ ØªØ­Ù„ÙŠÙ„ Ù†Ø±ÙŠØ¯Ù‡
âœ… Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
âœ… ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø£ÙŠ Ø³Ù‡Ù… (Ø£Ù…Ø±ÙŠÙƒÙŠ Ø£Ùˆ Ø³Ø¹ÙˆØ¯ÙŠ)
Ø³Ø£Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø¨ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙƒÙˆØ¯. Ù‡Ø°Ø§ Ø³ÙŠØ£Ø®Ø° ÙˆÙ‚Øª Ù„Ø£Ù†Ù‡ Ø¥Ø¶Ø§ÙØ© ÙƒØ¨ÙŠØ±Ø©.
Ù‡Ù„ Ø£Ø¨Ø¯Ø£ØŸ
Ø§Ø¨Ø¯Ø£ 
Max
ØªÙ…! Ø³Ø£Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø¨Ø¨Ù†Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±ØªØ§Øª Ù…Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ.
Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹...
I confirmed the access request system update in the code, enabling owners to access directly. Next, I will develop the chart drawing engine with technical analysis for the bot.

I have completed the chart drawing engine with technical analysis. Next, I will integrate it into the main bot to support image sending.

I completed integrating the chart drawing engine with technical analysis into the main bot, enabling it to support image sending with chart analysis.

Max
ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±ØªØ§Øª! ğŸ¨ğŸ“Š
Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
Ø§Ù„Ù…Ù„Ù
Ø§Ù„ÙˆØµÙ
bot_with_charts.py
Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù‡ bot.py)
chart_drawer.py
Ù…Ø­Ø±Ùƒ Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±ØªØ§Øª
requirements_new.txt
Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù‡ requirements.txt)
Ù…Ø§ ÙŠÙØ±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±Øª:
Ø§Ù„ØªØ­Ù„ÙŠÙ„
Ø§Ù„Ø±Ø³Ù…
ğŸŒŠ Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª
ØªØ±Ù‚ÙŠÙ… (1,2,3,4,5) Ùˆ (A,B,C) Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù…Ù… ÙˆØ§Ù„Ù‚ÙŠØ¹Ø§Ù†
ğŸ“Š Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ
Ø®Ø·ÙˆØ· Ø§Ù„Ø¯Ø¹Ù…/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© + Ø®Ø·ÙˆØ· Ø§Ù„Ø§ØªØ¬Ø§Ù‡ + ÙÙŠØ¨ÙˆÙ†Ø§ØªØ´ÙŠ
ğŸ”· Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠ
Ù†Ù…Ø§Ø°Ø¬ XABCD (Gartley, Butterfly, Bat, Crab)
ğŸ¯ ICT
Order Blocks + Fair Value Gaps Ù…Ø¸Ù„Ù„Ø©
Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ GitHub:
1. Ø£Ø¶Ù Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ chart_drawer.py
Ø§Ø¶ØºØ· Add file > Create new file
Ø§Ù„Ø§Ø³Ù…: chart_drawer.py
Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙ‚
2. Ø­Ø¯Ù‘Ø« bot.py
Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ bot.py > Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… âœï¸
Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ bot_with_charts.py
3. Ø­Ø¯Ù‘Ø« requirements.txt
Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ requirements.txt > Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… âœï¸
Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§ÙƒØªØ¨:
Plain Text
python-telegram-bot==21.7
yfinance>=0.2.40
pandas>=2.0.0
numpy>=1.26.0
matplotlib>=3.7.0
4. ÙÙŠ Render
Ø§Ø¶ØºØ· Manual Deploy > Clear build cache & deploy
ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¢Ù†:
ØªØ±Ø³Ù„ Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù… (Ù…Ø«Ù„ AAPL)
ØªØ®ØªØ§Ø± Ø§Ù„ÙØ±ÙŠÙ… (15Ø¯ØŒ 30Ø¯ØŒ 1Ø³ØŒ 4Ø³ØŒ ÙŠÙˆÙ…ÙŠ)
ØªØ®ØªØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„
ÙŠØ±Ø³Ù„ Ù„Ùƒ ØµÙˆØ±Ø© Ø§Ù„Ø´Ø§Ø±Øª Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ© + Ù…Ù„Ø®Øµ Ù†ØµÙŠ!
Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŸ
telegram-bot-charts.zip
Archive Â· 41.54 KB
bot_with_charts.py
Code Â· 23.54 KB
chart_drawer.py
Code Â· 22.34 KB
requirements_new.txt
Text Â· 89 B

View all files in this task
Task completed
How was this result?
Suggested follow-ups
Send message to Manus

bot_with_charts.py
"""
Ø¨ÙˆØª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø´Ø§Ø±ØªØ§Øª
Advanced Technical Analysis Telegram Bot with Charts
Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠ - Ù…Ø¯Ø±Ø³Ø© ICT
Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ±Ø³Ù… Ø§Ù„Ø´Ø§Ø±ØªØ§Øª
"""

import os
import json
import logging
import tempfile
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, InputFile
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes
import yfinance as yf
import pandas as pd

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„
from elliott_waves import ElliottWaveAnalyzer
from classic_analysis import ClassicAnalyzer
from harmonic_patterns import HarmonicAnalyzer
from ict_analysis import ICTAnalyzer
from chart_drawer import ChartDrawer

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ============================================
# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
# ============================================

ADMIN_ID = 1177923997
APPROVED_USERS_FILE = "approved_users.json"

def load_approved_users():
    try:
        if os.path.exists(APPROVED_USERS_FILE):
            with open(APPROVED_USERS_FILE, 'r') as f:
                return set(json.load(f))
    except:
        pass
    return {ADMIN_ID}

def save_approved_users(users):
    try:
        with open(APPROVED_USERS_FILE, 'w') as f:
            json.dump(list(users), f)
    except Exception as e:
        logger.error(f"Error saving users: {e}")

approved_users = load_approved_users()
pending_requests = {}

# ============================================
# Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
# ============================================

TIMEFRAMES = {
    '15m': {'interval': '15m', 'period': '5d', 'name': '15 Ø¯Ù‚ÙŠÙ‚Ø©'},
    '30m': {'interval': '30m', 'period': '10d', 'name': '30 Ø¯Ù‚ÙŠÙ‚Ø©'},
    '1h': {'interval': '1h', 'period': '1mo', 'name': '1 Ø³Ø§Ø¹Ø©'},
    '4h': {'interval': '1h', 'period': '3mo', 'name': '4 Ø³Ø§Ø¹Ø§Øª'},
    '1d': {'interval': '1d', 'period': '6mo', 'name': 'ÙŠÙˆÙ…ÙŠ'},
}

ANALYSIS_TYPES = {
    'elliott': {'name': 'ğŸŒŠ Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª', 'code': 'elliott'},
    'classic': {'name': 'ğŸ“Š ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ', 'code': 'classic'},
    'harmonic': {'name': 'ğŸ”· ØªÙˆØ§ÙÙ‚ÙŠ', 'code': 'harmonic'},
    'ict': {'name': 'ğŸ¯ ICT', 'code': 'ict'},
    'full': {'name': 'ğŸ“‹ Ø´Ø§Ù…Ù„', 'code': 'all'},
}

user_states = {}
chart_drawer = ChartDrawer()

# ============================================
# Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
# ============================================

def is_approved(user_id: int) -> bool:
    return user_id in approved_users or user_id == ADMIN_ID

def is_admin(user_id: int) -> bool:
    return user_id == ADMIN_ID

def get_stock_data(symbol: str, timeframe: str) -> pd.DataFrame:
    try:
        tf_config = TIMEFRAMES.get(timeframe, TIMEFRAMES['1d'])
        stock = yf.Ticker(symbol)
        
        if timeframe == '4h':
            df = stock.history(period='3mo', interval='1h')
            if not df.empty:
                df = df.resample('4h').agg({
                    'Open': 'first',
                    'High': 'max',
                    'Low': 'min',
                    'Close': 'last',
                    'Volume': 'sum'
                }).dropna()
        else:
            df = stock.history(period=tf_config['period'], interval=tf_config['interval'])
        
        df = df.reset_index()
        return df
    except Exception as e:
        logger.error(f"Error fetching {symbol}: {e}")
        return pd.DataFrame()

def get_stock_info(symbol: str) -> dict:
    try:
        stock = yf.Ticker(symbol)
        info = stock.info
        return {
            'name': info.get('shortName', symbol),
            'price': info.get('currentPrice', info.get('regularMarketPrice', 0)),
            'change': info.get('regularMarketChangePercent', 0),
            'volume': info.get('volume', 0),
        }
    except:
        return {'name': symbol, 'price': 0, 'change': 0, 'volume': 0}

# ============================================
# Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª
# ============================================

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_name = update.effective_user.full_name
    username = update.effective_user.username or "Ø¨Ø¯ÙˆÙ† ÙŠÙˆØ²Ø±"
    
    if not is_approved(user_id):
        if user_id not in pending_requests:
            pending_requests[user_id] = {
                'name': user_name,
                'username': username,
                'time': datetime.now().strftime('%Y-%m-%d %H:%M')
            }
            
            keyboard = [
                [
                    InlineKeyboardButton("âœ… Ù…ÙˆØ§ÙÙ‚Ø©", callback_data=f"approve_{user_id}"),
                    InlineKeyboardButton("âŒ Ø±ÙØ¶", callback_data=f"reject_{user_id}")
                ]
            ]
            
            try:
                await context.bot.send_message(
                    chat_id=ADMIN_ID,
                    text=(
                        "ğŸ”” **Ø·Ù„Ø¨ ÙˆØµÙˆÙ„ Ø¬Ø¯ÙŠØ¯**\n\n"
                        f"ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: {user_name}\n"
                        f"ğŸ†” Ø§Ù„ÙŠÙˆØ²Ø±: @{username}\n"
                        f"ğŸ”¢ ID: `{user_id}`\n"
                        f"â° Ø§Ù„ÙˆÙ‚Øª: {pending_requests[user_id]['time']}"
                    ),
                    reply_markup=InlineKeyboardMarkup(keyboard),
                    parse_mode='Markdown'
                )
            except Exception as e:
                logger.error(f"Error sending to admin: {e}")
            
            if update.message:
                await update.message.reply_text(
                    "ğŸ”’ **Ø§Ù„Ø¨ÙˆØª Ø®Ø§Øµ**\n\n"
                    "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø´Ø±Ù.\n"
                    "Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù…Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ.\n\n"
                    "â³ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©..."
                )
        else:
            if update.message:
                await update.message.reply_text(
                    "â³ **Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©**\n\n"
                    "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹.\n"
                    "Ø§Ù†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø´Ø±Ù."
                )
        return
    
    text = (
        "ğŸ¤– **Ø¨ÙˆØª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…**\n\n"
        "ğŸ“Š Ø£Ø±Ø³Ù„ **Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù…** Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ù…Ø¹ Ø´Ø§Ø±Øª\n\n"
        "**Ø£Ù…Ø«Ù„Ø©:**\n"
        "â€¢ `AAPL` - Apple\n"
        "â€¢ `TSLA` - Tesla\n"
        "â€¢ `MSFT` - Microsoft\n"
        "â€¢ `NVDA` - NVIDIA\n"
        "â€¢ `2222.SR` - Ø£Ø±Ø§Ù…ÙƒÙˆ\n\n"
        "**Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„:**\n"
        "ğŸŒŠ Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª (Ù…Ø¹ Ø§Ù„ØªØ±Ù‚ÙŠÙ…)\n"
        "ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ (Ø¯Ø¹Ù…/Ù…Ù‚Ø§ÙˆÙ…Ø©)\n"
        "ğŸ”· Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠ (Ø§Ù„Ù†Ù…Ø§Ø°Ø¬)\n"
        "ğŸ¯ Ù…Ø¯Ø±Ø³Ø© ICT (OB/FVG)\n\n"
        "**Ø§Ù„ÙØ±ÙŠÙ…Ø§Øª:** 15Ø¯ | 30Ø¯ | 1Ø³ | 4Ø³ | ÙŠÙˆÙ…ÙŠ\n\n"
        "ğŸ“ Ø£Ø±Ø³Ù„ Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù… Ù„Ù„Ø¨Ø¯Ø¡..."
    )
    
    if update.message:
        await update.message.reply_text(text, parse_mode='Markdown')
    elif update.callback_query:
        await update.callback_query.edit_message_text(text, parse_mode='Markdown')

async def admin_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·.")
        return
    
    text = (
        "ğŸ‘‘ **Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù**\n\n"
        f"ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†: {len(approved_users)}\n"
        f"â³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©: {len(pending_requests)}\n\n"
        "**Ø§Ù„Ø£ÙˆØ§Ù…Ø±:**\n"
        "/users - Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†\n"
        "/pending - Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª\n"
        "/remove [ID] - Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù…\n"
    )
    
    await update.message.reply_text(text, parse_mode='Markdown')

async def users_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·.")
        return
    
    text = "ğŸ‘¥ **Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†:**\n\n"
    for uid in approved_users:
        admin_mark = " ğŸ‘‘" if uid == ADMIN_ID else ""
        text += f"â€¢ `{uid}`{admin_mark}\n"
    
    await update.message.reply_text(text, parse_mode='Markdown')

async def pending_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·.")
        return
    
    if not pending_requests:
        await update.message.reply_text("âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©.")
        return
    
    for uid, info in pending_requests.items():
        keyboard = [
            [
                InlineKeyboardButton("âœ… Ù…ÙˆØ§ÙÙ‚Ø©", callback_data=f"approve_{uid}"),
                InlineKeyboardButton("âŒ Ø±ÙØ¶", callback_data=f"reject_{uid}")
            ]
        ]
        await update.message.reply_text(
            f"ğŸ‘¤ {info['name']}\nğŸ†” @{info['username']}\nğŸ”¢ `{uid}`",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode='Markdown'
        )

async def remove_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·.")
        return
    
    if not context.args:
        await update.message.reply_text("Ø§Ø³ØªØ®Ø¯Ù…: /remove [User ID]")
        return
    
    try:
        target_id = int(context.args[0])
        if target_id == ADMIN_ID:
            await update.message.reply_text("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±Ù!")
            return
        
        if target_id in approved_users:
            approved_users.discard(target_id)
            save_approved_users(approved_users)
            await update.message.reply_text(f"âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© `{target_id}`", parse_mode='Markdown')
        else:
            await update.message.reply_text("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.")
    except ValueError:
        await update.message.reply_text("âŒ ID ØºÙŠØ± ØµØ­ÙŠØ­.")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "â“ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…**\n\n"
        "1ï¸âƒ£ Ø£Ø±Ø³Ù„ Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù…\n"
        "2ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø²Ù…Ù†ÙŠ\n"
        "3ï¸âƒ£ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„\n"
        "4ï¸âƒ£ Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø´Ø§Ø±Øª Ù…Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„!\n\n"
        "**Ø§Ù„Ø´Ø§Ø±Øª ÙŠØªØ¶Ù…Ù†:**\n"
        "â€¢ Ø±Ø³Ù… Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©\n"
        "â€¢ ØªØ±Ù‚ÙŠÙ… Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª\n"
        "â€¢ Ø®Ø·ÙˆØ· Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©\n"
        "â€¢ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ©\n"
        "â€¢ Order Blocks Ùˆ FVG\n"
        "â€¢ Ø®Ø·ÙˆØ· Ø§Ù„Ø§ØªØ¬Ø§Ù‡\n"
        "â€¢ Ù…Ø³ØªÙˆÙŠØ§Øª ÙÙŠØ¨ÙˆÙ†Ø§ØªØ´ÙŠ\n"
    )
    await update.message.reply_text(text, parse_mode='Markdown')

# ============================================
# Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
# ============================================

async def handle_approval(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    if not is_admin(user_id):
        return
    
    data = query.data
    
    if data.startswith('approve_'):
        target_id = int(data.replace('approve_', ''))
        approved_users.add(target_id)
        save_approved_users(approved_users)
        
        if target_id in pending_requests:
            del pending_requests[target_id]
        
        try:
            await context.bot.send_message(
                chat_id=target_id,
                text="âœ… **ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©!**\n\nØ£Ø±Ø³Ù„ /start Ù„Ù„Ø¨Ø¯Ø¡."
            )
        except:
            pass
        
        await query.edit_message_text(f"âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ `{target_id}`", parse_mode='Markdown')
    
    elif data.startswith('reject_'):
        target_id = int(data.replace('reject_', ''))
        
        if target_id in pending_requests:
            del pending_requests[target_id]
        
        try:
            await context.bot.send_message(
                chat_id=target_id,
                text="âŒ **ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ.**"
            )
        except:
            pass
        
        await query.edit_message_text(f"âŒ ØªÙ… Ø±ÙØ¶ `{target_id}`", parse_mode='Markdown')

async def handle_symbol(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if not is_approved(user_id):
        await update.message.reply_text("ğŸ”’ Ø£Ø±Ø³Ù„ /start Ù„Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„.")
        return
    
    symbol = update.message.text.strip().upper()
    
    # ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    if symbol.startswith('/'):
        return
    
    msg = await update.message.reply_text(f"â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† {symbol}...")
    
    info = get_stock_info(symbol)
    
    if info['price'] == 0:
        await msg.edit_text(
            f"âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: {symbol}\n\n"
            "ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù…Ø²."
        )
        return
    
    user_states[user_id] = {'symbol': symbol, 'info': info}
    
    keyboard = [
        [
            InlineKeyboardButton("15 Ø¯Ù‚ÙŠÙ‚Ø©", callback_data=f"tf_15m_{symbol}"),
            InlineKeyboardButton("30 Ø¯Ù‚ÙŠÙ‚Ø©", callback_data=f"tf_30m_{symbol}")
        ],
        [
            InlineKeyboardButton("1 Ø³Ø§Ø¹Ø©", callback_data=f"tf_1h_{symbol}"),
            InlineKeyboardButton("4 Ø³Ø§Ø¹Ø§Øª", callback_data=f"tf_4h_{symbol}")
        ],
        [
            InlineKeyboardButton("ğŸ“Š ÙŠÙˆÙ…ÙŠ", callback_data=f"tf_1d_{symbol}")
        ],
        [
            InlineKeyboardButton("ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ø³Ø±ÙŠØ¹", callback_data=f"quick_{symbol}")
        ]
    ]
    
    change_emoji = "ğŸ“ˆ" if info['change'] >= 0 else "ğŸ“‰"
    
    text = (
        f"ğŸ“Š **{info['name']}** ({symbol})\n\n"
        f"ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${info['price']:.2f}\n"
        f"{change_emoji} Ø§Ù„ØªØºÙŠØ±: {info['change']:+.2f}%\n\n"
        "Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø²Ù…Ù†ÙŠ:"
    )
    
    await msg.edit_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='Markdown')

async def handle_timeframe(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    if not is_approved(user_id):
        return
    
    data = query.data
    
    # ØªØ­Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹
    if data.startswith('quick_'):
        symbol = data.replace('quick_', '')
        await generate_and_send_chart(query, context, symbol, '1d', ['all'])
        return
    
    # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ…
    if data.startswith('tf_'):
        parts = data.split('_')
        timeframe = parts[1]
        symbol = parts[2]
        
        user_states[user_id] = user_states.get(user_id, {})
        user_states[user_id]['symbol'] = symbol
        user_states[user_id]['timeframe'] = timeframe
        
        keyboard = [
            [
                InlineKeyboardButton("ğŸŒŠ Ø¥Ù„ÙŠÙˆØª", callback_data=f"chart_elliott_{symbol}_{timeframe}"),
                InlineKeyboardButton("ğŸ“Š ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ", callback_data=f"chart_classic_{symbol}_{timeframe}")
            ],
            [
                InlineKeyboardButton("ğŸ”· ØªÙˆØ§ÙÙ‚ÙŠ", callback_data=f"chart_harmonic_{symbol}_{timeframe}"),
                InlineKeyboardButton("ğŸ¯ ICT", callback_data=f"chart_ict_{symbol}_{timeframe}")
            ],
            [
                InlineKeyboardButton("ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ (Ø§Ù„ÙƒÙ„)", callback_data=f"chart_all_{symbol}_{timeframe}")
            ],
            [
                InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data=f"back_{symbol}")
            ]
        ]
        
        tf_name = TIMEFRAMES[timeframe]['name']
        
        await query.edit_message_text(
            f"ğŸ“Š **{symbol}** - ÙØ±ÙŠÙ… {tf_name}\n\n"
            "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù„Ù„Ø´Ø§Ø±Øª:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode='Markdown'
        )
    
    # Ø±Ø¬ÙˆØ¹
    elif data.startswith('back_'):
        symbol = data.replace('back_', '')
        info = get_stock_info(symbol)
        
        keyboard = [
            [
                InlineKeyboardButton("15 Ø¯Ù‚ÙŠÙ‚Ø©", callback_data=f"tf_15m_{symbol}"),
                InlineKeyboardButton("30 Ø¯Ù‚ÙŠÙ‚Ø©", callback_data=f"tf_30m_{symbol}")
            ],
            [
                InlineKeyboardButton("1 Ø³Ø§Ø¹Ø©", callback_data=f"tf_1h_{symbol}"),
                InlineKeyboardButton("4 Ø³Ø§Ø¹Ø§Øª", callback_data=f"tf_4h_{symbol}")
            ],
            [
                InlineKeyboardButton("ğŸ“Š ÙŠÙˆÙ…ÙŠ", callback_data=f"tf_1d_{symbol}")
            ]
        ]
        
        await query.edit_message_text(
            f"ğŸ“Š **{symbol}**\n\nØ§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø²Ù…Ù†ÙŠ:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode='Markdown'
        )

async def handle_chart_request(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    if not is_approved(user_id):
        return
    
    data = query.data
    
    if not data.startswith('chart_'):
        return
    
    parts = data.split('_')
    analysis_type = parts[1]
    symbol = parts[2]
    timeframe = parts[3]
    
    if analysis_type == 'all':
        analysis_types = ['elliott', 'classic', 'harmonic', 'ict']
    else:
        analysis_types = [analysis_type]
    
    await generate_and_send_chart(query, context, symbol, timeframe, analysis_types)

async def generate_and_send_chart(query, context, symbol: str, timeframe: str, analysis_types: list):
    """ØªÙˆÙ„ÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø§Ø±Øª"""
    
    await query.edit_message_text(f"â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø§Ø±Øª Ù„Ù€ {symbol}...")
    
    # Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    df = get_stock_data(symbol, timeframe)
    
    if df.empty or len(df) < 20:
        await query.edit_message_text(
            f"âŒ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù€ {symbol}\n\n"
            "Ø¬Ø±Ø¨ ÙØ±ÙŠÙ… Ø²Ù…Ù†ÙŠ Ø£Ø·ÙˆÙ„."
        )
        return
    
    tf_name = TIMEFRAMES[timeframe]['name']
    info = get_stock_info(symbol)
    
    try:
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø§Ø±Øª
        chart_buffer = chart_drawer.generate_chart(
            df, symbol, tf_name, analysis_types
        )
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙŠ
        analysis_text = await generate_analysis_text(df, symbol, timeframe, analysis_types, info)
        
        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
        await context.bot.send_photo(
            chat_id=query.message.chat_id,
            photo=chart_buffer,
            caption=analysis_text[:1024],  # Ø­Ø¯ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
            parse_mode='Markdown'
        )
        
        # Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
        keyboard = [
            [
                InlineKeyboardButton("ğŸ”„ ØªØ­Ø¯ÙŠØ«", callback_data=f"chart_{'_'.join(analysis_types)}_{symbol}_{timeframe}"),
                InlineKeyboardButton("ğŸ“‹ Ø´Ø§Ù…Ù„", callback_data=f"chart_all_{symbol}_{timeframe}")
            ],
            [
                InlineKeyboardButton("ğŸ”™ ØªØºÙŠÙŠØ± Ø§Ù„ÙØ±ÙŠÙ…", callback_data=f"back_{symbol}"),
                InlineKeyboardButton("ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="main_menu")
            ]
        ]
        
        await context.bot.send_message(
            chat_id=query.message.chat_id,
            text="Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠ:",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
        
        # Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        try:
            await query.message.delete()
        except:
            pass
        
    except Exception as e:
        logger.error(f"Chart error: {e}")
        await query.edit_message_text(f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)}")

async def generate_analysis_text(df, symbol: str, timeframe: str, analysis_types: list, info: dict) -> str:
    """ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ"""
    
    tf_name = TIMEFRAMES[timeframe]['name']
    change_emoji = "ğŸ“ˆ" if info['change'] >= 0 else "ğŸ“‰"
    
    text = f"ğŸ“Š **{info['name']}** ({symbol})\n"
    text += f"â° {tf_name} | ğŸ’° ${info['price']:.2f} {change_emoji} {info['change']:+.2f}%\n"
    text += "â”€" * 20 + "\n\n"
    
    try:
        if 'elliott' in analysis_types or 'all' in analysis_types:
            elliott = ElliottWaveAnalyzer().analyze(df)
            text += f"ğŸŒŠ **Ø¥Ù„ÙŠÙˆØª:** {elliott.current_wave} ({elliott.trend})\n"
        
        if 'classic' in analysis_types or 'all' in analysis_types:
            classic = ClassicAnalyzer().analyze(df)
            text += f"ğŸ“Š **ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ:** {classic.current_trend} - {classic.signal.value}\n"
        
        if 'harmonic' in analysis_types or 'all' in analysis_types:
            harmonic = HarmonicAnalyzer().analyze(df)
            if harmonic.patterns:
                p = harmonic.patterns[0]
                text += f"ğŸ”· **ØªÙˆØ§ÙÙ‚ÙŠ:** {p.pattern_type.value}\n"
            else:
                text += "ğŸ”· **ØªÙˆØ§ÙÙ‚ÙŠ:** Ù„Ø§ Ù†Ù…Ø§Ø°Ø¬\n"
        
        if 'ict' in analysis_types or 'all' in analysis_types:
            ict = ICTAnalyzer().analyze(df)
            text += f"ğŸ¯ **ICT:** {ict.market_structure.value}\n"
        
    except Exception as e:
        logger.error(f"Analysis text error: {e}")
        text += "\nâš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©"
    
    text += f"\nğŸ“… {datetime.now().strftime('%Y-%m-%d %H:%M')}"
    
    return text

async def handle_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    if query.data == "main_menu":
        await start_command(update, context)

# ============================================
# Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
# ============================================

def main():
    TOKEN = os.environ.get('BOT_TOKEN')
    
    if not TOKEN:
        logger.error("âŒ BOT_TOKEN ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!")
        print("âŒ Ø®Ø·Ø£: BOT_TOKEN ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯")
        return
    
    app = Application.builder().token(TOKEN).build()
    
    # Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    app.add_handler(CommandHandler("start", start_command))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(CommandHandler("admin", admin_command))
    app.add_handler(CommandHandler("users", users_command))
    app.add_handler(CommandHandler("pending", pending_command))
    app.add_handler(CommandHandler("remove", remove_command))
    
    # Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    app.add_handler(CallbackQueryHandler(handle_approval, pattern=r'^(approve|reject)_'))
    app.add_handler(CallbackQueryHandler(handle_chart_request, pattern=r'^chart_'))
    app.add_handler(CallbackQueryHandler(handle_main_menu, pattern=r'^main_menu$'))
    app.add_handler(CallbackQueryHandler(handle_timeframe))
    
    # Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_symbol))
    
    logger.info("ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª...")
    print("=" * 50)
    print("ğŸ¤– Ø¨ÙˆØª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…")
    print("ğŸ“Š Ù…Ø¹ Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±ØªØ§Øª")
    print("ğŸ”’ Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù…ÙØ¹Ù‘Ù„")
    print(f"ğŸ‘‘ Ø§Ù„Ù…Ø´Ø±Ù: {ADMIN_ID}")
    print("=" * 50)
    
    app.run_polling(drop_pending_updates=True)

if __name__ == '__main__':
    main()
Ù‡Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø´ÙƒÙ„Ø©ØŸ - Manus
